{"changed":true,"filter":false,"title":"components_processor.rb","tooltip":"/lib/polymer-rails/processors/components_processor.rb","value":"require 'polymer-rails/component'\n\nmodule Polymer\n  module Rails\n    class ComponentsProcessor < Sprockets::Processor\n\n      def initialize(context, data)\n        @context = context\n        @component = Component.new(data)\n      end\n\n      def process\n        inline_styles\n        inline_javascripts\n        require_imports\n        @component.stringify\n      end\n\n    private\n\n      def require_imports\n        @component.imports.each do |import|\n          @context.require_asset absolute_asset_path(import.attributes['href'].value)\n          import.remove\n        end\n      end\n\n      def inline_javascripts\n        @component.javascripts.each do |script|\n          @component.replace_node(script, 'script', asset_content(script.attributes['src'].value))\n        end\n      end\n\n      def inline_styles\n        @component.stylesheets.each do |link|\n          @component.replace_node(link, 'style', asset_content(link.attributes['href'].value))\n        end\n      end\n\n      def asset_content(file)\n        asset_path = absolute_asset_path(file)\n        asset      = find_asset(asset_path)\n        unless asset.blank?\n          @context.depend_on_asset asset_path\n          asset.to_s\n        else\n          nil\n        end\n      end\n\n      def absolute_asset_path(file)\n        search_file = file.sub(/^(\\.\\.\\/)+/, '/').sub(/^\\/*/, '')\n        ::Rails.application.assets.paths.each do |path|\n          file_list = Dir.glob( \"#{File.absolute_path search_file, path }*\")\n          return file_list.first unless file_list.blank?\n        end\n        components = Dir.glob(\"#{File.absolute_path file, File.dirname(@context.pathname)}*\")\n        return components.blank? ? nil : components.first\n      end\n\n      def find_asset(asset_path)\n        ::Rails.application.assets.find_asset(asset_path)\n      end\n\n    end\n  end\nend\n","undoManager":{"mark":17,"position":19,"stack":[[{"group":"doc","deltas":[{"start":{"row":8,"column":40},"end":{"row":9,"column":0},"action":"insert","lines":["",""]},{"start":{"row":9,"column":0},"end":{"row":9,"column":8},"action":"insert","lines":["        "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":8},"end":{"row":9,"column":9},"action":"insert","lines":["w"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"insert","lines":["\\"]},{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"insert","lines":["z"]},{"start":{"row":9,"column":11},"end":{"row":9,"column":12},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":11},"end":{"row":9,"column":12},"action":"remove","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"remove","lines":["z"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"remove","lines":["\\"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":9},"end":{"row":9,"column":10},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":10},"end":{"row":9,"column":11},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":11},"end":{"row":9,"column":12},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":12},"end":{"row":9,"column":13},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":13},"end":{"row":9,"column":15},"action":"insert","lines":["\"\""]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":14},"end":{"row":9,"column":33},"action":"insert","lines":["ComponentsProcessor"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":33},"end":{"row":9,"column":34},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":34},"end":{"row":9,"column":35},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":35},"end":{"row":9,"column":36},"action":"insert","lines":["n"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":36},"end":{"row":9,"column":37},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":34},"end":{"row":9,"column":37},"action":"remove","lines":["ini"]},{"start":{"row":9,"column":34},"end":{"row":9,"column":44},"action":"insert","lines":["initialize"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":44},"end":{"row":9,"column":45},"action":"insert","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":0},"end":{"row":9,"column":46},"action":"remove","lines":["        warn \"ComponentsProcessor initialized\""]}]}],[{"group":"doc","deltas":[{"start":{"row":9,"column":0},"end":{"row":10,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":502,"scrollleft":0,"selection":{"start":{"row":66,"column":0},"end":{"row":66,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1425458721698}